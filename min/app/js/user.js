var app_version="",isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},any:function(){return isMobile.Android()||isMobile.iOS()}},WEB_URL=server_type+_region+"-app.iscarmg.com",MEMBER_URL=server_type+_region+"-member.iscarmg.com",browser_width=$(window).width(),browser_height=$(window).height();loginInit=function(e){if(void 0!==Cookies.get(_main))i=JSON.parse(Cookies.get(_main));else var i={};if(i.mdId)userAvatarInit(),e(i);else if(void 0!=i.sat){var o={sat:i.sat,mur:i.murId};$.ajax({contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",url:"http://"+MEMBER_URL+"/api/query_member_basicinfo",data:JSON.stringify(JSON.stringify(o)),success:function(o){if(jsonUrlDecode(o),o.query_member_basicinforesult){var n=JSON.parse(JSON.stringify(o.query_member_basicinforesult));if("000000000"===n.message_no)i.mdId=n.md_id,i.md_cname=n.md_cname,i.md_picturepath=n.md_picturepath,i.loginType=n.md_logintype,i.md_city=n.md_city,i.md_country=n.md_country,i.rl_zip=n.rl_zip,i.rl_city_code=n.rl_city_code,i.md_clienttype=n.md_clienttype,i.md_fbgender=n.md_fbgender,i.md_birthday=n.md_birthday,i.md_clubjoinstatus=n.md_clubjoinstatus,i.sso_token=n.sso_token,i.md_seccode_created=n.md_seccode_created,Cookies.set(_main,JSON.stringify(i),{domain:"iscarmg.com"}),localStorage.setItem(_main,JSON.stringify(i)),userAvatarInit(),e(i);else switch(n.message_no){case"999999992":alert("憑證有誤")}}},error:function(e){console.log(JSON.stringify(e))}})}else userAvatarInit(),e(i)},$(".hot-key").html("<span>回主頁</span>"),$(".hot-key").click(function(){if(void 0!==Cookies.get(_main))e=JSON.parse(Cookies.get(_main));else var e={};window.location="http://"+WEB_URL+"/Shortcut-menu/transform?user_info="+encodeURIComponent(JSON.stringify(e))});var login_status;userAvatarInit=function(){if(void 0!==Cookies.get(_main))e=JSON.parse(Cookies.get(_main));else var e={};e.mdId?(login_status=!0,"0"===e.loginType?checkImage(e.md_picturepath,function(){login_status&&$(".iscar_member_icon").css("background-image","url("+e.md_picturepath+")")},function(){$(".iscar_member_icon").html(e.md_cname.substring(0,1)),$(".iscar_member_icon").css("background-image",'url("")'),$(".iscar_member_icon").css("background","orange"),$(".iscar_member_icon").css("width","35px"),$(".iscar_member_icon").css("height","35px"),$(".iscar_member_icon").css("text-align","center"),$(".iscar_member_icon").css("line-height","35px"),$(".iscar_member_icon").css("font-weight","bold")}):"2"===e.loginType?$(".iscar_member_icon").css("background-image","url(http://"+MEMBER_URL+"/app/image/general_user.png)"):"3"===e.loginType&&($(".iscar_member_icon").html(e.md_cname.substring(0,1)),$(".iscar_member_icon").css("background-image",'url("")'),$(".iscar_member_icon").css("background","orange"),$(".iscar_member_icon").css("width","35px"),$(".iscar_member_icon").css("height","35px"),$(".iscar_member_icon").css("text-align","center"),$(".iscar_member_icon").css("line-height","35px"),$(".iscar_member_icon").css("font-weight","bold")),$(".iscar_member_icon").css("background-size","35px")):(login_status=!1,$(".navbar .center").css("left","8px"),$(".navbar .right").css("width","66px"),$(".iscar_member_icon").html("登入/註冊"),$(".iscar_member_icon").css("background","rgba(0,0,0,0)"),$(".iscar_member_icon").css("background-image","rgba(0,0,0,0)"),$(".iscar_member_icon").css("width","66px"),$(".iscar_member_icon").css("height","44px"),$(".iscar_member_icon").css("line-height","44px"),$(".iscar_member_icon").css("font-size",".8em")),$(".iscar_member_login").click(function(){var e=Cookies.get("parameter");e=atob(decodeURIComponent(e));var i=(e=JSON.parse(e)).modacc;if(Cookies.set("mod",i,{domain:"iscarmg.com"}),void 0!==Cookies.get(_main))o=JSON.parse(Cookies.get(_main));else var o={};(app_version=localStorage.getItem("app_version"))?o.mdId?window.location="http://"+WEB_URL+"/User-menu/transform?user_info="+encodeURIComponent(JSON.stringify(o)):window.location="http://"+MEMBER_URL+"/transform?user_info="+encodeURIComponent(JSON.stringify(o))+"&parameter="+getCookie("parameter"):window.location.href.match("webend_admin")||(o.mdId?window.location="http://"+WEB_URL+"/User-menu/transform?user_info="+encodeURIComponent(JSON.stringify(o)):window.location="http://"+MEMBER_URL+"/transform?user_info="+encodeURIComponent(JSON.stringify(o))+"&parameter="+getCookie("parameter"))}),$("body").prepend('<div class="draggable-block"></div>'),browser_width<992?($(".draggable-block").css("width",browser_width),$(".draggable-block").css("height",browser_height)):($(".draggable-block").css("width",$("body").width()),$(".draggable-block").css("height",browser_height),$(".draggable-block").css("margin","0 auto")),$(".hot-key").html("回主頁"),$(".hot-key").click(function(){if(void 0!==Cookies.get(_main))e=JSON.parse(Cookies.get(_main));else var e={};window.location="http://"+WEB_URL+"/Shortcut-menu/transform?user_info="+encodeURIComponent(JSON.stringify(e))}),$(".hot-key").draggable({containment:".draggable-block",distance:25,scroll:!1,zIndex:5500})},checkImage=function(e,i,o){var n=new Image;n.onload=i,n.onerror=o,n.src=e},bindingCheck=function(e){switch($$(".modal.modal-in").length>0&&myApp.closeModal(".binding-modal"),e){case"facebook":myApp.modal({title:stringObj.text.warn,text:stringObj.text.fbBindingContext,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.binding,onClick:function(){fbEvent="binding",redirect_uri="http://"+WEB_URL+"/fb-binding",window.location="https://www.facebook.com/v2.8/dialog/oauth?client_id=875839542533172&display=popup&response_type=token&redirect_uri="+redirect_uri+"&auth_type=rerequest&scope=publish_actions"}}]});break;default:myApp.alert('<div class="row"><div class="col-50" onclick="bindingCheck(\'facebook\')" style="margin: 0 auto;"><img src="../app/image/facebook_icon.png" onerror=\'this.src="../app/image/imgDefault.png"\' /></div></div>',"<div>"+stringObj.text.noBinding+"</div><div>"+stringObj.text.bindingType+"</div>"),$(".modal").addClass("binding-modal")}},jsonUrlDecode=function(e){for(var i in e)"object"==typeof e[i]?this.jsonUrlDecode(e[i]):e[i]=decodeURIComponent(e[i])},toWeb=function(e){if(isMobile.Android())Android.toWeb(e);else if(isMobile.iOS())iPhone.toWeb(e);else{window.open(e,"_blank").focus()}},getCookie=function(e){var i=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=i?unescape(i[2]):null};